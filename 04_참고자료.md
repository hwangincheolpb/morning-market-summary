# 참고자료

## 문서

### VBA 및 Excel
- [Microsoft VBA 문서](https://docs.microsoft.com/ko-kr/office/vba/api/overview/) - VBA 공식 문서
- [Excel VBA 참조](https://docs.microsoft.com/ko-kr/office/vba/api/overview/excel) - Excel 객체 모델
- [WinHttp 문서](https://docs.microsoft.com/en-us/windows/win32/winhttp/about-winhttp) - HTTP 요청

### Gemini API
- [Google Gemini API 문서](https://ai.google.dev/docs) - Gemini API 공식 문서
- [Gemini API 빠른 시작](https://ai.google.dev/tutorials/quickstart) - API 사용 가이드
- [Gemini API Python 예제](https://github.com/google/generative-ai-python) - 참고용 (VBA로 변환)

### 발송 서비스 API
- [알리고 API 문서](https://smspartner.aligo.in/) - 알리고 SMS API
- [카카오톡 비즈니스 API](https://developers.kakao.com/docs/latest/ko/kakaotalk-business/common) - 카카오톡 발송 API
- [나이스정보통신 SMS API](https://www.nicetel.co.kr/) - SMS 서비스

### 시황 데이터 API
- [Alpha Vantage API](https://www.alphavantage.co/documentation/) - 주식/환율 데이터 (무료)
- [Yahoo Finance API](https://www.yahoofinanceapi.com/) - 금융 데이터
- [한국투자증권 Open API](https://apiportal.koreainvestment.com/) - 국내 주식 데이터
- [한국은행 경제통계시스템](https://ecos.bok.or.kr/) - 금리, 환율 데이터

### 스케줄링
- [Windows Task Scheduler](https://docs.microsoft.com/en-us/windows/win32/taskschd/task-scheduler-start-page) - 작업 스케줄러
- [VBA Application.OnTime](https://docs.microsoft.com/en-us/office/vba/api/excel.application.ontime) - 엑셀 내부 스케줄링

## 링크

### VBA 라이브러리
- [VBA-JSON](https://github.com/VBA-tools/VBA-JSON) - VBA용 JSON 파서
- [VBA-Web](https://github.com/VBA-tools/VBA-Web) - VBA용 HTTP 클라이언트

### 유사 프로젝트
- [Excel 자동화 예제](https://www.excel-easy.com/vba.html) - VBA 예제
- [금융 데이터 수집 예제](https://github.com/search?q=excel+stock+data) - 참고용

## 코드 예제

### VBA - HTTP 요청 (WinHttp)

```vba
Function GetHTTPResponse(url As String, Optional headers As String) As String
    Dim http As Object
    Dim response As String
    
    Set http = CreateObject("WinHttp.WinHttpRequest.5.1")
    
    http.Open "GET", url, False
    If headers <> "" Then
        ' 헤더 설정
        Dim headerArray() As String
        headerArray = Split(headers, vbCrLf)
        Dim i As Integer
        For i = 0 To UBound(headerArray)
            Dim keyValue() As String
            keyValue = Split(headerArray(i), ":")
            If UBound(keyValue) = 1 Then
                http.SetRequestHeader Trim(keyValue(0)), Trim(keyValue(1))
            End If
        Next i
    End If
    http.Send
    
    If http.Status = 200 Then
        response = http.ResponseText
    Else
        response = "Error: " & http.Status & " - " & http.StatusText
    End If
    
    GetHTTPResponse = response
    Set http = Nothing
End Function
```

### VBA - Gemini API 호출

```vba
Function GetGeminiSummary(marketData As String, apiKey As String) As String
    Dim http As Object
    Dim url As String
    Dim requestBody As String
    Dim response As String
    Dim json As Object
    
    url = "https://generativelanguage.googleapis.com/v1beta/models/gemini-pro:generateContent?key=" & apiKey
    
    ' 프롬프트 구성
    Dim prompt As String
    prompt = "다음은 오늘 아침 금융 시황 데이터입니다. " & _
             "한국어로 간결하고 이해하기 쉽게 요약해주세요. " & _
             "주요 지수, 환율, 금리, 원자재 가격을 포함하세요." & vbCrLf & vbCrLf & _
             marketData
    
    requestBody = "{""contents"":[{""parts"":[{""text"":""" & EscapeJSON(prompt) & """}]}]}"
    
    Set http = CreateObject("WinHttp.WinHttpRequest.5.1")
    http.Open "POST", url, False
    http.SetRequestHeader "Content-Type", "application/json"
    http.Send requestBody
    
    If http.Status = 200 Then
        ' JSON 파싱 (VBA-JSON 라이브러리 필요)
        Set json = JsonConverter.ParseJson(http.ResponseText)
        response = json("candidates")(1)("content")("parts")(1)("text")
    Else
        response = "Error: " & http.Status & " - " & http.StatusText
    End If
    
    GetGeminiSummary = response
    Set http = Nothing
End Function

Function EscapeJSON(text As String) As String
    EscapeJSON = Replace(Replace(Replace(text, "\", "\\"), """", "\"""), vbCrLf, "\n")
End Function
```

### VBA - 시황 데이터 수집 (Alpha Vantage 예제)

```vba
Function GetStockPrice(symbol As String, apiKey As String) As String
    Dim http As Object
    Dim url As String
    Dim response As String
    Dim json As Object
    
    ' Alpha Vantage API
    url = "https://www.alphavantage.co/query?function=GLOBAL_QUOTE&symbol=" & symbol & "&apikey=" & apiKey
    
    Set http = CreateObject("WinHttp.WinHttpRequest.5.1")
    http.Open "GET", url, False
    http.Send
    
    If http.Status = 200 Then
        Set json = JsonConverter.ParseJson(http.ResponseText)
        response = json("Global Quote")("05. price")
    Else
        response = "Error"
    End If
    
    GetStockPrice = response
    Set http = Nothing
End Function

Function GetExchangeRate(fromCurrency As String, toCurrency As String, apiKey As String) As String
    Dim http As Object
    Dim url As String
    Dim response As String
    Dim json As Object
    
    ' Alpha Vantage API
    url = "https://www.alphavantage.co/query?function=CURRENCY_EXCHANGE_RATE&from_currency=" & _
          fromCurrency & "&to_currency=" & toCurrency & "&apikey=" & apiKey
    
    Set http = CreateObject("WinHttp.WinHttpRequest.5.1")
    http.Open "GET", url, False
    http.Send
    
    If http.Status = 200 Then
        Set json = JsonConverter.ParseJson(http.ResponseText)
        response = json("Realtime Currency Exchange Rate")("5. Exchange Rate")
    Else
        response = "Error"
    End If
    
    GetExchangeRate = response
    Set http = Nothing
End Function
```

### VBA - 알리고 SMS 발송

```vba
Function SendSMS_Aligo(phoneNumber As String, message As String, apiKey As String, userId As String, sender As String) As Boolean
    Dim http As Object
    Dim url As String
    Dim postData As String
    Dim response As String
    
    url = "https://apis.aligo.in/send/"
    
    postData = "key=" & apiKey & _
               "&user_id=" & userId & _
               "&sender=" & sender & _
               "&receiver=" & phoneNumber & _
               "&msg=" & URLEncode(message)
    
    Set http = CreateObject("WinHttp.WinHttpRequest.5.1")
    http.Open "POST", url, False
    http.SetRequestHeader "Content-Type", "application/x-www-form-urlencoded"
    http.Send postData
    
    If http.Status = 200 Then
        response = http.ResponseText
        ' 응답 파싱하여 성공 여부 확인
        SendSMS_Aligo = (InStr(response, """result_code"":1") > 0)
    Else
        SendSMS_Aligo = False
    End If
    
    Set http = Nothing
End Function

Function URLEncode(text As String) As String
    ' 간단한 URL 인코딩 (실제로는 더 완전한 구현 필요)
    URLEncode = Replace(Replace(Replace(text, " ", "%20"), vbCrLf, "%0A"), "&", "%26")
End Function
```

### VBA - 카카오톡 발송 (알림톡)

```vba
Function SendKakaoTalk(phoneNumber As String, message As String, accessToken As String, templateCode As String) As Boolean
    Dim http As Object
    Dim url As String
    Dim jsonData As String
    Dim response As String
    
    url = "https://kapi.kakao.com/v1/api/talk/friends/message/send"
    
    jsonData = "{""receiver_uuids"":[""" & phoneNumber & """],""template_object"":{""object_type"":""text"",""text"":""" & _
               EscapeJSON(message) & """}}"
    
    Set http = CreateObject("WinHttp.WinHttpRequest.5.1")
    http.Open "POST", url, False
    http.SetRequestHeader "Authorization", "Bearer " & accessToken
    http.SetRequestHeader "Content-Type", "application/json"
    http.Send jsonData
    
    If http.Status = 200 Then
        SendKakaoTalk = True
    Else
        SendKakaoTalk = False
    End If
    
    Set http = Nothing
End Function
```

### VBA - 메인 워크플로우

```vba
Sub RunMorningReport()
    On Error GoTo ErrorHandler
    
    Dim wsSettings As Worksheet
    Dim wsRecipients As Worksheet
    Dim wsHistory As Worksheet
    Dim apiKey As String
    Dim marketData As String
    Dim summary As String
    Dim i As Long
    Dim recipientPhone As String
    Dim recipientName As String
    Dim sendChannel As String
    
    Set wsSettings = ThisWorkbook.Sheets("설정")
    Set wsRecipients = ThisWorkbook.Sheets("수신자목록")
    Set wsHistory = ThisWorkbook.Sheets("발송이력")
    
    ' API 키 읽기
    apiKey = DecryptPassword(wsSettings.Cells(2, 2).Value) ' Gemini API 키
    
    ' 1. 시황 데이터 수집
    marketData = CollectMarketData()
    
    ' 2. Gemini 요약 생성
    summary = GetGeminiSummary(marketData, apiKey)
    
    ' 3. 수신자 목록 읽기 및 발송
    i = 2 ' 헤더 다음 행부터
    Do While wsRecipients.Cells(i, 1).Value <> ""
        If wsRecipients.Cells(i, 5).Value = "Y" Then ' 활성화된 수신자
            recipientName = wsRecipients.Cells(i, 1).Value
            recipientPhone = wsRecipients.Cells(i, 2).Value
            sendChannel = wsRecipients.Cells(i, 3).Value
            
            ' 발송
            If sendChannel = "SMS" Or sendChannel = "둘다" Then
                Call SendSMS_Aligo(recipientPhone, summary, ...)
            End If
            
            If sendChannel = "카톡" Or sendChannel = "둘다" Then
                Call SendKakaoTalk(recipientPhone, summary, ...)
            End If
            
            ' 이력 기록
            Call LogHistory(wsHistory, recipientName, recipientPhone, summary, Now)
        End If
        i = i + 1
    Loop
    
    MsgBox "발송 완료!"
    Exit Sub
    
ErrorHandler:
    Call LogError(Err.Description)
    MsgBox "오류 발생: " & Err.Description
End Sub
```

### VBA - Windows Task Scheduler 연동 (VBS 스크립트)

```vbs
' RunMorningReport.vbs
Set objExcel = CreateObject("Excel.Application")
objExcel.Visible = False
objExcel.DisplayAlerts = False

Set objWorkbook = objExcel.Workbooks.Open("C:\Path\To\MorningReport.xlsm")
objExcel.Run "RunMorningReport"

objWorkbook.Save
objWorkbook.Close
objExcel.Quit
```

### PowerShell - Task Scheduler 등록

```powershell
# Task Scheduler에 등록
$action = New-ScheduledTaskAction -Execute "wscript.exe" -Argument "C:\Path\To\RunMorningReport.vbs"
$trigger = New-ScheduledTaskTrigger -Daily -At "07:00"
$principal = New-ScheduledTaskPrincipal -UserId $env:USERNAME -LogonType Interactive
Register-ScheduledTask -TaskName "MorningMarketReport" -Action $action -Trigger $trigger -Principal $principal
```

## 관련 프로젝트

- [템플릿](./../템플릿/) - 프로젝트 템플릿 구조

## 학습 자료

### Gemini API 학습
- [Gemini API 튜토리얼](https://ai.google.dev/tutorials) - API 사용법
- [프롬프트 엔지니어링](https://ai.google.dev/docs/prompt_intro) - 효과적인 프롬프트 작성

### 금융 데이터
- [금융 API 가이드](https://www.investopedia.com/articles/investing/090314/apis-investors-should-know.asp) - 투자자용 API
- [주식 데이터 수집 방법](https://www.dataquest.io/blog/python-api-tutorial/) - Python 예제 (참고)

### 발송 서비스
- [SMS 발송 서비스 비교](https://www.aligo.in/) - 국내 SMS 서비스
- [카카오톡 비즈니스 가이드](https://business.kakao.com/) - 카카오톡 비즈니스

## 노트

### Gemini API 접근 방법
- Google AI Studio에서 API 키 발급
- 무료 할당량 확인 필요
- Rate limit 고려

### 시황 데이터 소스 선택
- 무료 API 우선 활용 (Alpha Vantage, Yahoo Finance)
- 국내 데이터는 한국투자증권 Open API 고려
- 웹 스크래핑은 법적 고려 필요

### 발송 서비스 선택
- 알리고: 국내 주요 서비스, 안정적
- 카카오톡: 비즈니스 계정 필요, 비용 고려
- 여러 서비스 지원하여 선택 가능하도록

### 비용 고려사항
- Gemini API: 무료 할당량 확인
- SMS 발송: 건당 비용
- 카카오톡: 비즈니스 계정 비용
- 데이터 API: 무료 할당량 또는 유료

### 향후 확장 아이디어
- 이메일 발송 추가
- 슬랙/텔레그램 연동
- 웹 대시보드 제공
- 모바일 앱 연동
- 개인화된 포트폴리오 분석
