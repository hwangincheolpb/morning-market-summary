# 아침 시황 요약 자동화 - 클로드코드 인수인계 문서

## 📋 프로젝트 개요

매일 마감 후 텔레그램 채널과 웹사이트에서 시황 데이터를 수집 → Gemini API로 요약 → 텔레그램으로 나에게 발송하는 자동화 시스템

## ⚡ 클로드코드 작업 지침 (중요!)

### 자동으로 처리할 것
- ✅ **웹 브라우징**: 필요한 정보 찾기, 웹사이트 구조 확인 등 → **자동으로 진행**
- ✅ **코드 수정**: 버그 수정, 기능 개선 → **바로 적용**
- ✅ **라이브러리 확인**: 문서나 예제 찾기 → **자동으로 처리**
- ✅ **에러 해결**: 문제 발생 시 로그 확인하고 **자동으로 수정**

### 사용자에게만 확인할 것
- ❓ **중요한 결정**: Gemini vs DeepSeek 선택 같은 큰 방향 결정
- ❓ **API 키 없음**: 실제 키가 없어서 테스트 불가능할 때만
- ❓ **명확하지 않은 요구사항**: 기능 스펙이 애매할 때만

**원칙: 귀찮은 권한 요청/확인은 피하고, 필요한 정보는 직접 찾아서 자동으로 처리하라!**

## ✅ 현재 완성 상태

### 완성된 모듈
- ✅ **데이터 수집 모듈** (`collectors.py`): 텔레그램 채널 + 웹사이트 수집
- ✅ **Gemini 요약 모듈** (`gemini_summarizer.py`): 기존 GEM 프롬프트 적용
- ✅ **발송 모듈** (`sender.py`): 텔레그램 발송 (예전 코드 방식으로 수정 완료)
- ✅ **메인 워크플로우** (`main.py`): 수집 → 요약 → 발송 통합
- ✅ **스케줄러** (`scheduler.py`): 자동 실행 기능

### 파일 구조
```
아침_시황_요약_자동화/
├── main.py                  # 메인 실행 스크립트
├── collectors.py            # 데이터 수집 모듈
├── gemini_summarizer.py     # Gemini 요약 모듈
├── sender.py                # 텔레그램 발송 모듈
├── scheduler.py             # 스케줄링 모듈
├── config.py.example        # 설정 예시 파일
├── requirements.txt         # 필수 패키지
├── README_구현.md           # 구현 가이드
├── 구현_요구사항_정리.md    # 요구사항 문서
└── 인수인계.md              # 이 문서
```

## 📝 데이터 소스

### 1. 텔레그램 채널
- **채널**: https://t.me/shmstory
- **채널명**: 시황맨의 주식이야기
- **수집 방식**: 웹 스크래핑 (현재 구현)
- **주의**: 더 안정적으로 하려면 텔레그램 Bot API 사용 고려 (채널 구독 필요)

### 2. 웹사이트
- **URL**: https://www.briefing.com/stock-market-update
- **업데이트**: 마감 후 30분 정도 안에 마감시황 업데이트
- **수집 방식**: 웹 스크래핑 (BeautifulSoup)

## ⚙️ 설정 필요 사항

### 1. config.py 생성
```bash
copy config.py.example config.py
```

### 2. 필수 설정값
```python
# Gemini API 키 (필수)
GEMINI_API_KEY = "여기에_발급받은_Gemini_API_키"

# 텔레그램 봇 토큰 (필수)
TELEGRAM_BOT_TOKEN = "여기에_봇_토큰"

# 텔레그램 채팅 ID (필수) - 나에게 발송할 ID
TELEGRAM_SEND_TO_CHAT_ID = "여기에_내_채팅_ID"

# 텔레그램 채널 (기본값 있음)
TELEGRAM_CHANNEL_USERNAME = "shmstory"

# 웹사이트 URL (기본값 있음)
WEBSITE_URL = "https://www.briefing.com/stock-market-update"
```

### 3. API 키 발급 방법

#### Gemini API 키
1. https://makersuite.google.com/app/apikey 접속
2. API 키 생성
3. `config.py`의 `GEMINI_API_KEY`에 입력

#### 텔레그램 봇 토큰
1. 텔레그램에서 @BotFather 찾기
2. `/newbot` 명령 입력
3. 봇 이름과 사용자명 설정
4. 받은 토큰을 `TELEGRAM_BOT_TOKEN`에 입력

#### 텔레그램 채팅 ID 확인
1. 텔레그램에서 @userinfobot에게 메시지 보내기
2. 받은 ID를 `TELEGRAM_SEND_TO_CHAT_ID`에 입력

## 🔧 설치 및 실행

### 1. 패키지 설치
```bash
pip install -r requirements.txt
```

### 2. 수동 실행 테스트
```bash
python main.py
```

### 3. 자동 실행 (스케줄러)
```bash
python scheduler.py
```

## ⚠️ 검토 필요 사항 (클로드코드가 자동으로 처리)

### 1. 텔레그램 채널 수집 방식
- **현재**: 웹 스크래핑 (불안정할 수 있음)
- **대안**: 텔레그램 Bot API 사용
  - 봇을 채널에 관리자로 추가
  - `bot.get_updates()` 또는 `bot.forwardMessage()` 사용
- **조치**: 웹 브라우징으로 실제 채널 구조 확인하고 최적 방법 선택

### 2. 웹사이트 스크래핑
- Briefing.com의 실제 HTML 구조 확인 필요
- 현재는 기본적인 파싱만 구현됨
- **조치**: 웹 브라우징으로 실제 HTML 구조 확인하고 파싱 코드 수정

### 3. Gemini API 대안
- 사용자가 "딥시크" 언급 → DeepSeek API 사용 고려
- DeepSeek 사용 시 `gemini_summarizer.py` 수정 필요
- OpenAI 호환 API라 `openai` 라이브러리로 변경 가능

### 4. 요약 프롬프트
- 현재 간결 버전 프롬프트 적용됨
- 사용자가 보여준 예시 양식과 정확히 맞는지 확인 필요
- 필요시 프롬프트 미세 조정

## 📊 출력 양식

### 간결 버전 (현재 기본)
```
신한투자증권 서울금융센터 황인철PB입니다.

🇺🇸 [날짜] 미국 증시: [핵심 키워드]

✅ 핵심 요약
 * [핵심 요약 1]
 * [핵심 요약 2]
 * [핵심 요약 3]

📊 주요 지수
다우 [지수] ([등락률])
나스닥 [지수] ([등락률])
S&P 500 [지수] ([등락률])
MSCI 한국 [등락률]

📉 매크로 지표
 * 달러인덱스: [수치] ([등락률])
 * 국제유가: [수치] ([등락률])
 * 10년물 금리: [수치]
 * 변동성(VIX): [수치] ([등락률])

감사합니다.
```

## 🐛 예상 문제점 및 해결 방안

### 1. 텔레그램 채널 수집 실패
**문제**: 웹 스크래핑 방식은 텔레그램 웹 버전 구조 변경에 취약  
**해결**: 
- 텔레그램 Bot API로 변경
- 봇을 채널에 추가하고 메시지 수신

### 2. 웹사이트 파싱 실패
**문제**: Briefing.com HTML 구조 확인 필요  
**해결**: 
- 실제 페이지 HTML 확인
- `collectors.py`의 `BriefingComCollector.get_market_update()` 수정

### 3. Gemini API 제한
**문제**: 무료 버전 사용량 제한  
**해결**: 
- DeepSeek API로 대체 고려
- API 키 여러 개 순환 사용

### 4. 메시지 길이 초과
**문제**: 텔레그램 메시지 4096자 제한  
**해결**: 
- 이미 분할 전송 로직 구현됨 (`sender.py`)
- 필요시 요약 길이 제한 추가

## 📚 참고 자료

### 예전 코드
- `hwangincheol/Sovereign OS/00. Active Projects/Philosophy Extraction/Data/Gemini/04_Tech/_코드 수정 요청 응답_ .md`
  - Briefing.com 크롤링 예시
  - 텔레그램 발송 코드 (`telegram.Bot` 직접 사용)

### 사용자 예시 메시지
- 간결 버전 양식 예시 다수 제공됨
- `구현_요구사항_정리.md`에 예시 포함

### 텔레그램 Bot API
- 공식 문서: https://core.telegram.org/bots/api
- Python 라이브러리: `telegram` 패키지 (예전 코드와 동일)

## 🎯 다음 단계 제안 (클로드코드가 진행)

1. **웹사이트 구조 확인** ⚡ 자동
   - Briefing.com 실제 HTML 구조 확인 (웹 브라우징)
   - 텔레그램 채널 웹 버전 구조 확인
   - 수집 코드 실제 구조에 맞게 수정

2. **API 선택 및 구현** ⚡ 자동
   - Gemini vs DeepSeek 비교 (웹 검색)
   - 선택한 API로 코드 수정
   - DeepSeek 선택 시 `gemini_summarizer.py` 수정

3. **테스트 및 디버깅** ⚡ 자동
   - 실제 데이터 수집 테스트
   - 에러 발생 시 자동 수정
   - 재시도 로직 추가

4. **프롬프트 최적화** ⚡ 자동
   - 사용자 예시와 출력 결과 비교
   - 필요시 프롬프트 미세 조정

5. **완성 및 보고**
   - 동작 확인 후 사용자에게 최종 결과 보고
   - 설정 방법 및 사용법 안내

## 💡 추가 기능 제안

- 발송 이력 저장 (파일 또는 DB)
- 요약 품질 평가 및 개선
- 여러 수신자 지원
- 이메일 발송 기능 추가
- 웹 대시보드 (선택)
- **블로그 자동 업로드 기능** (구현 완료 후 추가 예정)
  - 요약 내용을 자동으로 블로그에 포스팅
  - 블로그 플랫폼은 사용자가 선택 (예: 티스토리, 브런치 등)

## 📝 작업 기록 관리

### 작업 로그
- 작업 내역은 `작업_로그.md` 같은 파일로 기록 가능
- 구현 완료 후 정리 여부 결정을 기록에 남기기
- 중요한 결정이나 변경사항 기록

### 구현 완료 후 작업
- 정리 여부 결정 (코드 정리, 불필요 파일 삭제 등)
- 블로그 자동 업로드 기능 추가
  - 요약 내용을 자동으로 블로그에 포스팅
  - 블로그 API 연동 필요

## 📞 질문 및 이슈

문제 발생 시:
1. 로그 확인 (`print` 문으로 디버깅 정보 출력)
2. 각 모듈 개별 테스트
3. API 키 및 토큰 유효성 확인
4. 네트워크 연결 확인

---

**작성일**: 2026-01-20  
**작성자**: Claude (Auto)  
**상태**: 기본 구조 완성, 테스트 및 개선 필요
